kind: pipeline
name: default
type: docker

steps:
  - name: build-push
    image: plugins/docker
    settings:
      username:
        from_secret: DOCKER_USER
      password:
        from_secret: DOCKER_PASS
      repo: vladerc/fpm-nginx
      tags:
        - "dev"
        - "${DRONE_COMMIT_SHA:0:8}"
      dockerfile: docker/api/Dockerfile
    when:
      event: push

  - name: build-tag
    image: plugins/docker
    settings:
      username:
        from_secret: DOCKER_USER
      password:
        from_secret: DOCKER_PASS
      repo: vladerc/fpm-nginx
      tags:
        - "latest"
        - "stable"
        - "${DRONE_COMMIT_SHA:0:8}"
        - "${DRONE_TAG}"
      dockerfile: docker/api/Dockerfile
    when:
      event: tag